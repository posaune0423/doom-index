# Cloudflare Workers Configuration for DOOM INDEX

name = "doom-index"
main = "src/worker.ts"
compatibility_date = "2025-03-25"
compatibility_flags = [
 "nodejs_compat",
 "nodejs_compat_populate_process_env",
 "global_fetch_strictly_public",
]

# Cron Triggers - 毎分実行
[triggers]
crons = ["0 * * * *"]

# R2 Bucket Binding
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "doom-index-storage"

[[r2_buckets]]
binding = "NEXT_INC_CACHE_R2_BUCKET"
bucket_name = "doom-index-next-inc-cache"

# Next.js on Cloudflare Pages の設定は別途 open-next.config.ts で管理
[assets]
directory = "./.open-next/assets"
binding = "ASSETS"

[[services]]
binding = "WORKER_SELF_REFERENCE"
service = "doom-index"


[observability]
[observability.logs]
enabled = false
head_sampling_rate = 1
invocation_logs = true
persist = true
