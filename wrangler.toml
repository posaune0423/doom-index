# Cloudflare Workers Configuration for DOOM INDEX


name = "doom-index"
main = "./src/worker.ts"

compatibility_date = "2025-03-25"
compatibility_flags = [
 "nodejs_compat",
 "nodejs_compat_populate_process_env",
 "global_fetch_strictly_public",
]

# Custom build settings
[build]
command = "bun run build:cf"

# Cron Triggers
[triggers]
crons = ["* * * * *"] # Every minute

[[routes]]
pattern = "doomindex.fun"
custom_domain = true

# R2 Bucket Binding
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "doom-index-storage"

[[r2_buckets]]
binding = "NEXT_INC_CACHE_R2_BUCKET"
bucket_name = "doom-index-next-inc-cache"

# KV Namespace Binding
[[kv_namespaces]]
binding = "VIEWER_KV"
id = "8c588d03a8ab4cd19e0c458dcabf1bec"

# Next.js on Cloudflare Pages is managed in open-next.config.ts
[assets]
directory = "./.open-next/assets"
binding = "ASSETS"


[[services]]
binding = "WORKER_SELF_REFERENCE"
service = "doom-index"

[vars]
NODE_ENV = "production"
LOG_LEVEL = "INFO"
NEXTJS_ENV = "production"
# NEXT_PUBLIC_BASE_URL = "https://doomindex.fun"
IMAGE_MODEL = "runware:100@1"

[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1
